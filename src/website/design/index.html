<!DOCTYPE html>
<html>
â€‹

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../public/css/index.css">
    <title>Open Chat</title>
</head>

<body onload="onBodyLoad()">
    <section id="app" class="app">        
        <section class="sidebar">
            <header>   
                <label class="avatar-button">   
                    <img id="myAvatar" class="avatar" data-identicon-value="f62142836846128685a" />
                    <input style="display:none" type="file" accept=".jpg, .jpeg, .png, .gif" onchange="onAvatarFileSelected(event)" />
                </label>
                <div>
                    <div class="ddl">
                        <button onclick="toggleDDL('chatsMenu')" class="ddl-button hide-on-click-ignore">
                            <svg class="ddl-button-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M12 7a2 2 0 1 0-.001-4.001A2 2 0 0 0 12 7zm0 2a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 9zm0 6a2 2 0 1 0-.001 3.999A2 2 0 0 0 12 15z"></path></svg>
                        </button>
                        <div id="chatsMenu" class="ddl-content hide-on-click-outside hide" onclick="toggleDDL('chatsMenu')">
                            <a href="#">New group</a>
                            <a href="#">New chat</a>
                            <a href="#">Profile</a>
                            <a href="#">Settings</a>
                            <a href="#">Logout</a>
                        </div>
                    </div>
                </div>
            </header>
            <div class="search">
                <input value="Search or start a new chat" onfocus="value=''" onblur="value='Search or start a new chat'" />
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15.009 13.805h-.636l-.22-.219a5.184 5.184 0 0 0 1.256-3.386 5.207 5.207 0 1 0-5.207 5.208 5.183 5.183 0 0 0 3.385-1.255l.221.22v.635l4.004 3.999 1.194-1.195-3.997-4.007zm-4.808 0a3.605 3.605 0 1 1 0-7.21 3.605 3.605 0 0 1 0 7.21z"></path></svg>                
            </div>
            <ul class="chats">
                <li>
                    <img class="avatar" data-identicon-value="aaaabbbb3382734326745" />
                    <div class="message-container">
                        <div>
                            <div class="date">today</div>
                            <div class="name">John Smith</div>
                        </div>
                        <div>
                            <div class="unread-count">2</div>                            
                            <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing elit</div>
                        </div>
                    </div>
                </li>
                <li class="selected">
                    <img class="avatar" src="matt.jpeg" />
                    <div class="message-container">
                        <div class="date">yesterday</div>
                        <div class="name">Matt Grogan</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut 
                            labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco 
                            laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in 
                            voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat 
                            non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</div>
                    </div>
                </li>
                <li>
                    <img class="avatar" src="hamish.jpeg" />
                    <div class="message-container">
                        <div class="date">yesterday</div>
                        <div class="name">Hamish Peebles</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing elit s dasds dasdda s</div>
                    </div>
                </li>
                <li>
                    <svg class="avatar" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" width="212" height="212"><path fill="#DFE5E7" class="background" d="M105.946.25C164.318.25 211.64 47.596 211.64 106s-47.322 105.75-105.695 105.75C47.571 211.75.25 164.404.25 106S47.571.25 105.946.25z"></path><path fill="#FFF" class="primary" d="M61.543 100.988c8.073 0 14.246-6.174 14.246-14.246s-6.173-14.246-14.246-14.246-14.246 6.173-14.246 14.246 6.174 14.246 14.246 14.246zm8.159 17.541a48.192 48.192 0 0 1 8.545-6.062c-4.174-2.217-9.641-3.859-16.704-3.859-21.844 0-28.492 15.67-28.492 15.67v8.073h26.181l.105-.248c.303-.713 3.164-7.151 10.365-13.574zm80.755-9.921c-6.854 0-12.21 1.543-16.336 3.661a48.223 48.223 0 0 1 8.903 6.26c7.201 6.422 10.061 12.861 10.364 13.574l.105.248h25.456v-8.073c-.001 0-6.649-15.67-28.492-15.67zm0-7.62c8.073 0 14.246-6.174 14.246-14.246s-6.173-14.246-14.246-14.246-14.246 6.173-14.246 14.246 6.173 14.246 14.246 14.246zm-44.093 3.21a23.21 23.21 0 0 0 4.464-.428c.717-.14 1.419-.315 2.106-.521 1.03-.309 2.023-.69 2.976-1.138a21.099 21.099 0 0 0 3.574-2.133 20.872 20.872 0 0 0 5.515-6.091 21.283 21.283 0 0 0 2.121-4.823 22.16 22.16 0 0 0 .706-3.193c.16-1.097.242-2.224.242-3.377s-.083-2.281-.242-3.377a22.778 22.778 0 0 0-.706-3.193 21.283 21.283 0 0 0-3.272-6.55 20.848 20.848 0 0 0-4.364-4.364 21.099 21.099 0 0 0-3.574-2.133 21.488 21.488 0 0 0-2.976-1.138 22.33 22.33 0 0 0-2.106-.521 23.202 23.202 0 0 0-4.464-.428c-12.299 0-21.705 9.405-21.705 21.704 0 12.299 9.406 21.704 21.705 21.704zM145.629 131a36.739 36.739 0 0 0-1.2-1.718 39.804 39.804 0 0 0-3.367-3.967 41.481 41.481 0 0 0-3.442-3.179 42.078 42.078 0 0 0-5.931-4.083 43.725 43.725 0 0 0-3.476-1.776c-.036-.016-.069-.034-.104-.05-5.692-2.581-12.849-4.376-21.746-4.376-8.898 0-16.055 1.795-21.746 4.376-.196.089-.379.185-.572.276a43.316 43.316 0 0 0-3.62 1.917 42.32 42.32 0 0 0-5.318 3.716 41.501 41.501 0 0 0-3.443 3.179 40.632 40.632 0 0 0-3.366 3.967c-.452.61-.851 1.186-1.2 1.718-.324.493-.6.943-.841 1.351l-.061.101a27.96 27.96 0 0 0-.622 1.119c-.325.621-.475.975-.475.975v11.692h82.53v-11.692s-.36-.842-1.158-2.195a35.417 35.417 0 0 0-.842-1.351z"></path></svg>
                    <div class="message-container">
                        <div class="date">Tuesday</div>
                        <div class="name">Family</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" src="alice.jpeg" />
                    <div class="message-container">
                        <div class="date">Tuesday</div>
                        <div class="name">Alice Grogan</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" src="calum.jpeg" />
                    <div class="message-container">
                        <div class="date">Monday</div>
                        <div class="name">Calum Peebles</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing elit</div>
                    </div>
                </li>
                <li>
                    <img class="avatar" data-identicon-value="c157a79031e1c40f85931829bc5fc552" />
                    <div class="message-container">
                        <div class="date">Saturday</div>
                        <div class="name">Jane Doe</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing elit s dasds dasdda s</div>
                    </div>
                </li>
                <li>
                    <svg class="avatar" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" width="212" height="212"><path fill="#DFE5E7" class="background" d="M105.946.25C164.318.25 211.64 47.596 211.64 106s-47.322 105.75-105.695 105.75C47.571 211.75.25 164.404.25 106S47.571.25 105.946.25z"></path><path fill="#FFF" class="primary" d="M61.543 100.988c8.073 0 14.246-6.174 14.246-14.246s-6.173-14.246-14.246-14.246-14.246 6.173-14.246 14.246 6.174 14.246 14.246 14.246zm8.159 17.541a48.192 48.192 0 0 1 8.545-6.062c-4.174-2.217-9.641-3.859-16.704-3.859-21.844 0-28.492 15.67-28.492 15.67v8.073h26.181l.105-.248c.303-.713 3.164-7.151 10.365-13.574zm80.755-9.921c-6.854 0-12.21 1.543-16.336 3.661a48.223 48.223 0 0 1 8.903 6.26c7.201 6.422 10.061 12.861 10.364 13.574l.105.248h25.456v-8.073c-.001 0-6.649-15.67-28.492-15.67zm0-7.62c8.073 0 14.246-6.174 14.246-14.246s-6.173-14.246-14.246-14.246-14.246 6.173-14.246 14.246 6.173 14.246 14.246 14.246zm-44.093 3.21a23.21 23.21 0 0 0 4.464-.428c.717-.14 1.419-.315 2.106-.521 1.03-.309 2.023-.69 2.976-1.138a21.099 21.099 0 0 0 3.574-2.133 20.872 20.872 0 0 0 5.515-6.091 21.283 21.283 0 0 0 2.121-4.823 22.16 22.16 0 0 0 .706-3.193c.16-1.097.242-2.224.242-3.377s-.083-2.281-.242-3.377a22.778 22.778 0 0 0-.706-3.193 21.283 21.283 0 0 0-3.272-6.55 20.848 20.848 0 0 0-4.364-4.364 21.099 21.099 0 0 0-3.574-2.133 21.488 21.488 0 0 0-2.976-1.138 22.33 22.33 0 0 0-2.106-.521 23.202 23.202 0 0 0-4.464-.428c-12.299 0-21.705 9.405-21.705 21.704 0 12.299 9.406 21.704 21.705 21.704zM145.629 131a36.739 36.739 0 0 0-1.2-1.718 39.804 39.804 0 0 0-3.367-3.967 41.481 41.481 0 0 0-3.442-3.179 42.078 42.078 0 0 0-5.931-4.083 43.725 43.725 0 0 0-3.476-1.776c-.036-.016-.069-.034-.104-.05-5.692-2.581-12.849-4.376-21.746-4.376-8.898 0-16.055 1.795-21.746 4.376-.196.089-.379.185-.572.276a43.316 43.316 0 0 0-3.62 1.917 42.32 42.32 0 0 0-5.318 3.716 41.501 41.501 0 0 0-3.443 3.179 40.632 40.632 0 0 0-3.366 3.967c-.452.61-.851 1.186-1.2 1.718-.324.493-.6.943-.841 1.351l-.061.101a27.96 27.96 0 0 0-.622 1.119c-.325.621-.475.975-.475.975v11.692h82.53v-11.692s-.36-.842-1.158-2.195a35.417 35.417 0 0 0-.842-1.351z"></path></svg>
                    <div class="message-container">
                        <div class="date">05/01/2021</div>
                        <div class="name">Tetbury Rugby U8s Coaches</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" data-identicon-value="6765348727463241" />
                    <div class="message-container">
                        <div class="date">05/01/2021</div>
                        <div class="name">Gene Kelly</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" data-identicon-value="9387516871236871587" />
                    <div class="message-container">
                        <div class="date">05/01/2021</div>
                        <div class="name">Fred Astaire</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" data-identicon-value="2313412312341123" />
                    <div class="message-container">
                        <div class="date">05/01/2021</div>
                        <div class="name">Greta Garbo</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
                <li>
                    <img class="avatar" data-identicon-value="768759679485769" />
                    <div class="message-container">
                        <div class="date">05/01/2021</div>
                        <div class="name">Madonna</div>
                        <div class="chats-message">Lorem ipsum dolor sit amet, consectetur adipiscing</div>
                    </div>
                </li>   
            </ul>
        </section>
        <main>
            <header>            
                <button class="avatar-button">  
                    <img class="avatar" src="matt.jpeg" />                  
                </button>      
                <div>   
                    <div class="name">Matt Grogan</div>
                    <div class="date">last seen today at 15:10</div>
                </div>
            </header>
            <div id="messages" class="detail">
                <div class="day-container">
                    <div class="day-change-marker">Sunday 10th January 2021</div>
                    <div class="message them">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        I've just joined that google chat group
                        <span class="message-time">14:25</span>
                    </div>
                    <div class="message them merge">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        the one that got emailed round
                        <span class="message-time">14:25</span>
                    </div>
                    <div class="message them merge">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        that might be better for us to use while slack is down
                        <span class="message-time">14:25</span>
                    </div>
                    <div class="message me">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Hello? Are you there?
                        <span class="message-time">14:32</span>
                    </div>
                    <div class="message them">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        U still online for a quick call?
                        <span class="message-time">14:25</span>
                    </div>
                    <div class="message them">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                        laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in
                        voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat
                        non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
                        <span class="message-time">18:32</span>
                    </div>
                    <div class="message them">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Itâ€™s not important tho so can wait until 2moz
                        <span class="message-time">20:01</span>
                    </div>
                </div>
                <div class="day-container">
                    <div class="day-change-marker">Monday 11th January 2021</div>
                    <div class="message me top">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Hello? Are you there?
                        <span class="message-time">09:16</span>
                    </div>
                    <div class="message me merge middle">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Around the rugged rock the rugged rascal ran
                        <span class="message-time">09:17</span>
                    </div>
                    <div class="message me merge middle">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                        labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                        <span class="message-time">09:17</span>
                    </div>
                    <div class="message me merge bottom">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        She sells sea shells on the sea shore
                        <span class="message-time">09:17</span>
                    </div>
                    <div class="message me media">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        <img class="message-media" src="pug1.jpeg" />
                        <!-- <span class="caption">So cute!!!!</span> -->
                        <span class="message-time">09:22</span>
                    </div>
                    <div class="message me">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        So cute!!!!
                        <span class="message-time">09:22</span>
                    </div>
                    <div class="message them">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        Lorem ipsum dolor sit ðŸ˜€ amet, ðŸ˜€consectetur
                        <span class="message-time">09:22</span>
                    </div>
                    <div class="message them media">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" 3iewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        <video class="message-media" controls>
                            <source src="rabbit.mp4" type="video/mp4"/>
                            Your browser does not support the video tag.
                        </video>
                        <span class="message-time">09:22</span>
                    </div>
                    <div class="message me file">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        <a class="download-file" href="pug1.jpeg" role="button" title='Download "pug1.jpeg"' download>
                            <div class="file-icon"></div>
                            <div class="file-name">pug1.jpeg</div>
                        </a>
                        <span class="file-size">JPEG - 10 KB</span>
                        <span class="message-time">09:35</span>
                    </div>
                    <div class="message them file">
                        <svg class="down-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M3.3 4.6L9 10.3l5.7-5.7 1.6 1.6L9 13.4 1.7 6.2l1.6-1.6z"></path></svg>
                        <a class="download-file" href="pug1.jpeg" download>
                            <div class="file-icon"></div>
                            <div class="file-name">pug1.jpeg</div>
                        </a>
                        <span class="file-size">JPEG - 10 KB</span>
                        <span class="message-time">09:35</span>
                    </div>
                </div>
            </div>
            <footer class="enter-message">
                <div class="buttons">
                    <div class="smiley button" onclick="insertTextAtCaret('ðŸ˜€')">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9.153 11.603c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962zm-3.204 1.362c-.026-.307-.131 5.218 6.063 5.551 6.066-.25 6.066-5.551 6.066-5.551-6.078 1.416-12.129 0-12.129 0zm11.363 1.108s-.669 1.959-5.051 1.959c-3.505 0-5.388-1.164-5.607-1.959 0 0 5.912 1.055 10.658 0zM11.804 1.011C5.609 1.011.978 6.033.978 12.228s4.826 10.761 11.021 10.761S23.02 18.423 23.02 12.228c.001-6.195-5.021-11.217-11.216-11.217zM12 21.354c-5.273 0-9.381-3.886-9.381-9.159s3.942-9.548 9.215-9.548 9.548 4.275 9.548 9.548c-.001 5.272-4.109 9.159-9.382 9.159zm3.108-9.751c.795 0 1.439-.879 1.439-1.962s-.644-1.962-1.439-1.962-1.439.879-1.439 1.962.644 1.962 1.439 1.962z"></path></svg>
                    </div>
                    <label class="attach button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.576-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z"></path></svg>
                        <input style="display:none" type="file" />
                    </label>
                </div>
                <div class="message-input-container">
                    <div 
                        id="messageInput" 
                        class="message-input" 
                        onkeyup="saveSelection()"
                        onmouseup="saveSelection()"
                        onpaste="pastePlainText(event)"
                        contenteditable="true" 
                        spellcheck="true"></div>
                </div>
                <button onclick="newMessage.value=''; scrollMessagesToBottom()" class="send"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M1.101 21.757L23.8 12.028 1.101 2.3l.011 7.912 13.623 1.816-13.623 1.817-.011 7.912z"></path></svg></button>
            </footer>
        </main>
    </section>

    <script src="../../../node_modules/identicon.js/identicon.js"></script>

    <script lang="javascript">

        let savedRange;

        function onBodyLoad() {
            scrollMessagesToBottom();
            
            let textBox = document.getElementById("messageInput");
            textBox.addEventListener("textInput", onTextBoxTextInput, true);
        }

        function onTextBoxTextInput(e) {
            // Markup the text so it will appear correctly in the textbox
            const text = markupNewTextForTextBox(e.data);

            // If the text hasn't been marked-up then go ahead with the text input event
            if (text == e.data)
                return;

            // Otherwise cancel it and manually insert the mark-up 
            e.preventDefault();
            document.execCommand("insertHTML", false, text);
        }

        function insertTextAtCaret(text) {
            // We want to manually insert text in the editable textbox at the selection. However the 
            // document selection might not currently be inside the textbox so we save the range of the 
            // last seen selection inside the textbox and then use that here. If there is no existing 
            // saved range then initialise one at the end of the text box.
            if (!savedRange) {
                let textBox = document.getElementById("messageInput");
                savedRange = new Range();
                savedRange.selectNodeContents(textBox);
                savedRange.collapse(false);
            }

            // Apply the saved range selection to the document
            let selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(savedRange);

            // Markup the text so it will appear correctly in the textbox and manually insert it
            document.execCommand("insertHTML", false, markupNewTextForTextBox(text));

            // Save the new selection range
            saveSelection();
        }

        function saveSelection() {
            savedRange = window.getSelection().getRangeAt(0);
        }

        function pastePlainText(e) {
            // Cancel the paste event
            e.preventDefault();

            // Get plain text representation of clipboard
            var text = (e.originalEvent ?? e).clipboardData.getData('text/plain');

            // Markup the text so it will appear correctly in the textbox
            text = markupNewTextForTextBox(text);
            
            // Manually insert marked-up text
            document.execCommand("insertHTML", false, text);
        }
        
        function markupNewTextForTextBox(text) {
            // If the selection is inside an "emoji span" then ensure that any initial non-emoji characters 
            // are inside their own "plain span" to split them out
            const insideEmojiSpan = isSelectionInsideEmojiSpan();

            let foundEmoji = false;
            let textForPlainSpan = "";
            let markup = "";
            for (const c of text) {
                const isEmoji = containsEmoji(c);

                if (insideEmojiSpan && !foundEmoji && isEmoji && textForPlainSpan.length > 0) {
                    markup = buildPlainSpan(textForPlainSpan);
                }

                foundEmoji = foundEmoji || isEmoji;

                if (insideEmojiSpan && !foundEmoji) {
                    textForPlainSpan += c;
                } else if (isEmoji) {
                    markup += buildEmojiSpan(c);
                } else {
                    markup += c;
                }
            }      
            
            if (insideEmojiSpan && !foundEmoji && textForPlainSpan.length > 0) {
                markup = buildPlainSpan(textForPlainSpan);
            }

            return markup;
        }

        function isSelectionInsideEmojiSpan() {
            const range = window.getSelection().getRangeAt(0);
            const parent = range.commonAncestorContainer;
            const grandParent = parent.parentElement;

            return (parent.nodeName == "SPAN" && parent.classList.contains("emoji")) 
                || (parent.nodeName == "#text" && (grandParent.nodeName == "SPAN" && grandParent.classList.contains("emoji")));
        }

        function buildEmojiSpan(c) {
            return `<span class="emoji">${c}</span>`;
        }

        function buildPlainSpan(text) {
            return `<span>${text}</span>`;
        }

        function containsEmoji(text) {
            const regex_emoji = /[\p{Extended_Pictographic}\u{1F3FB}-\u{1F3FF}\u{1F9B0}-\u{1F9B3}]/u;
            return regex_emoji.test(text);
        }

        function scrollMessagesToBottom() {
            var objDiv = document.getElementById("messages");
            objDiv.scrollTop = objDiv.scrollHeight;            
        }

        function onAvatarFileSelected(event) {
            let files = event.target.files;

            if (files && files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document
                        .getElementById("myAvatar")
                        .setAttribute("src", e.target.result);
                }
                reader.readAsDataURL(files[0]);
            }
        }

        function generateIdenticons(id, user) {

            let images = document.querySelectorAll('[data-identicon-value]');

            for (let image of images) {
                let data = new Identicon(                    
                    image.getAttribute("data-identicon-value"), 
                    { margin: 0,format: 'svg' }).toString();

                image.src = "data:image/svg+xml;base64," + data;
            }
        }

        function toggleDDL(id) {
            document.getElementById(id).classList.toggle("hide");
        }

        window.onclick = function (event) {
            if (event.target.matches('.hide-on-click-ignore, .hide-on-click-ignore *, .hide-on-click-outside, .hide-on-click-outside *'))
                return;

            const dropdowns = document.getElementsByClassName("hide-on-click-outside");
            for (let dropdown of dropdowns) {
                dropdown.classList.add('hide');
            }
        }

        generateIdenticons();

    </script>
</body>
â€‹

</html>
