-- Cleanup
dfx identity remove alice
dfx identity remove calum
dfx identity remove hamish
dfx identity remove matt

-- Preamble
dfx identity new alice
dfx identity new calum
dfx identity new hamish
dfx identity new matt

dfx --identity=alice canister call user_mgmt register_user '("Alice")'
dfx --identity=calum canister call user_mgmt register_user '("Calum")'
dfx --identity=hamish canister call user_mgmt register_user '("Hamish")'
dfx --identity=matt canister call user_mgmt register_user '("Matt")'

-- Direct Chat
dfx --identity=hamish canister call user_mgmt get_user_id '("Matt")'
dfx --identity=hamish canister call chats create_direct_chat '(principal "lpfg6-5goq7-vn6yz-wegiu-r6goc-sxoor-wj3b2-dpyup-k6i5m-qhv5m-xae", "Hi Matt, how is it going")'
dfx --identity=hamish canister call chats send_message '(45_292_552_032_833_753, "hello!!??")'
dfx --identity=matt canister call chats get_chats '(record { updated_since = null; message_count_for_top_chat = null })'
dfx --identity=matt canister call chats get_messages '(45_292_552_032_833_753, 1)'
dfx --identity=matt canister call chats mark_read '(45_292_552_032_833_753, 2)'
dfx --identity=matt canister call chats send_message '(45_292_552_032_833_753, "whats up?")'

-- Group Chat
dfx --identity=matt canister call user_mgmt get_user_id '("Hamish")'
dfx --identity=matt canister call chats create_group_chat '(vec { principal "uhpjy-crxbe-6chrq-vadba-aqrmz-f4d2e-h7nxj-7hrso-ebvqe-gnygw-tae" }, "Xmas 2020")'
dfx --identity=matt canister call chats send_message '(12_699_180_841_646_933_661, "Are you coming to mine for xmas?")'

dfx deploy user_index --argument '(record { service_principals = vec {}; sms_service_principals = vec {}; test_mode = true; user_wasm_module = blob "" })'
dfx canister install user_index --mode=reinstall --argument '(record { service_principals = vec {}; sms_service_principals = vec {}; test_mode = true; user_wasm_module = blob "" })'
dfx --identity=matt canister call --query user_index current_user '(record { })'
dfx --identity=matt canister call user_index submit_phone_number '(record { phone_number = record { country_code = 44; number = "07778 588510" } })'
dfx --identity=matt canister call user_index confirm_phone_number '(record { confirmation_code = "123456" })'
dfx --identity=matt canister call user_index set_username '(record { username = "Matt" })'

dfx deploy user --argument '(record { notification_canister_ids = vec {}; owner = principal "czfqq-wsqcp-34akk-p5ax7-rvqwv-6cgwc-kr2rr-4fr3f-mka7k-5haqh-hqe" })'

-- Get Users
dfx --identity=matt canister call user_mgmt get_users '(vec { record { id = principal "uhpjy-crxbe-6chrq-vadba-aqrmz-f4d2e-h7nxj-7hrso-ebvqe-gnygw-tae"; cached_version = opt 1 } })'

-- Search for users
dfx canister call user_mgmt search_users '(record { search_term = "ali"; max_results = 10 })'

// Deploy II
II_ENV=development dfx deploy --no-wallet --argument '(null)'

// Metrics
dfx canister --network=ic --no-wallet call user_mgmt stats '()'
dfx canister --network=ic --no-wallet call chats stats '()'

// Notifications
dfx deploy notifications --argument '(record { push_service_principals = vec { principal "tu45y-p4p3d-b4gg4-gmyy3-rgweo-whsrq-fephi-vshrn-cipca-xdkri-pae" } })'
dfx canister install notifications --mode=reinstall --argument '(record { push_service_principals = vec { principal "tu45y-p4p3d-b4gg4-gmyy3-rgweo-whsrq-fephi-vshrn-cipca-xdkri-pae" } })'
dfx canister call notifications notifications '(record { from_notification_index = 0 })' 

dfx canister install notifications --mode=upgrade --argument '(record { push_service_principals = vec { principal "tu45y-p4p3d-b4gg4-gmyy3-rgweo-whsrq-fephi-vshrn-cipca-xdkri-pae" } })'