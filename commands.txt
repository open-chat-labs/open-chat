-- Cleanup
dfx identity remove alice
dfx identity remove calum
dfx identity remove hamish
dfx identity remove matt

-- Preamble
dfx identity new alice
dfx identity new calum
dfx identity new hamish
dfx identity new matt

dfx --identity=alice canister call user_mgmt register_user '("Alice")'
dfx --identity=calum canister call user_mgmt register_user '("Calum")'
dfx --identity=hamish canister call user_mgmt register_user '("Hamish")'
dfx --identity=matt canister call user_mgmt register_user '("Matt")'

-- Direct Chat
dfx --identity=hamish canister call user_mgmt get_user_id '("Matt")'
dfx --identity=hamish canister call chats create_direct_chat '(principal "lpfg6-5goq7-vn6yz-wegiu-r6goc-sxoor-wj3b2-dpyup-k6i5m-qhv5m-xae", "Hi Matt, how is it going")'
dfx --identity=hamish canister call chats send_message '(45_292_552_032_833_753, "hello!!??")'
dfx --identity=matt canister call chats get_chats '(record { updated_since = null; message_count_for_top_chat = null })'
dfx --identity=matt canister call chats get_messages '(45_292_552_032_833_753, 1)'
dfx --identity=matt canister call chats mark_read '(45_292_552_032_833_753, 2)'
dfx --identity=matt canister call chats send_message '(45_292_552_032_833_753, "whats up?")'

-- Group Chat
dfx --identity=matt canister call user_mgmt get_user_id '("Hamish")'
dfx --identity=matt canister call chats create_group_chat '(vec { principal "uhpjy-crxbe-6chrq-vadba-aqrmz-f4d2e-h7nxj-7hrso-ebvqe-gnygw-tae" }, "Xmas 2020")'
dfx --identity=matt canister call chats send_message '(12_699_180_841_646_933_661, "Are you coming to mine for xmas?")'

-- Get Users
dfx --identity=matt canister call user_mgmt get_users '(vec { record { id = principal "uhpjy-crxbe-6chrq-vadba-aqrmz-f4d2e-h7nxj-7hrso-ebvqe-gnygw-tae"; cached_version = opt 1 } })'
